<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details | RestaurantJobs Kenya</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Playfair+Display:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <!-- Navbar -->
    <!-- Navbar -->
    <nav class="container">
        <a href="/" class="nav-brand">Restaurant<span style="color: var(--accent-color);">Jobs</span></a>

        <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="Toggle Menu">&#9776;</button>

        <div id="nav-links" class="nav-links">
            <a href="/">Home</a>
            <a href="/jobs.html">Find Jobs</a>
            <a href="/employer-register.html">Submit Job</a>
            <a href="/apply.html" style="color: var(--accent-color);">Submit CV</a>
        </div>
    </nav>

    <main class="container" style="padding: 40px 20px; max-width: 800px;">
        <a href="/jobs.html" style="text-decoration: none; color: var(--text-muted);">&larr; Back to Jobs</a>

        <div id="loading" style="margin-top: 40px; text-align: center;">Loading job details...</div>

        <div id="job-content" style="display: none; margin-top: 20px;">
            <h1 id="job-title" style="font-size: 2.5rem; margin-bottom: 10px;">Job Title</h1>

            <div style="display: flex; gap: 20px; margin-bottom: 30px; font-size: 1.1rem; color: var(--text-muted);">
                <span id="job-location">üìç Location</span>
                <span id="job-type">‚è± Type</span>
                <span id="job-date">üìÖ Posted: Date</span>
            </div>

            <div class="card" style="padding: 40px; margin-bottom: 40px;">
                <h3 style="margin-bottom: 20px;">Job Description</h3>
                <div id="job-description" style="line-height: 1.8; white-space: pre-wrap;">
                    <!-- Description goes here -->
                </div>
            </div>

            <div style="text-align: center;">
                <a id="apply-btn" href="#" class="btn" style="padding: 15px 40px; font-size: 1.2rem;">Apply for this
                    Job</a>
            </div>
        </div>

        <div id="error-msg" style="display: none; text-align: center; margin-top: 50px;">
            <h2>Job Not Found</h2>
            <p>The job you are looking for does not exist or has been removed.</p>
            <a href="/jobs.html" class="btn" style="margin-top: 20px;">Browse All Jobs</a>
        </div>
    </main>

    <!-- Footer -->
    <footer style="background-color: var(--text-main); color: white; padding: 40px 0; margin-top: 80px;">
        <div class="container">
            <p style="text-align: center; color: #999; font-size: 0.9rem;">&copy; 2026 RestaurantJobs Kenya. All rights
                reserved.</p>
        </div>
    </footer>

    <script type="module" src="/src/ui.js"></script>
    <script type="module">
        import { supabase } from './src/supabaseClient.js';

        async function loadJobDetails() {
            const params = new URLSearchParams(window.location.search);
            const jobId = params.get('id');

            if (!jobId) {
                showError();
                return;
            }

            try {
                const { data: job, error } = await supabase
                    .from('jobs')
                    .select('*')
                    .eq('id', jobId)
                    .single();

                if (error) throw error;
                if (!job) throw new Error('Job not found (ID might be invalid)');

                // Render Content
                document.getElementById('job-title').innerText = job.title;
                document.getElementById('job-location').innerText = 'üìç ' + job.location;
                document.getElementById('job-type').innerText = '‚è± ' + job.type;
                document.getElementById('job-date').innerText = 'üìÖ Posted: ' + new Date(job.created_at).toLocaleDateString();
                document.getElementById('job-description').innerHTML = job.description;

                // Render Logo if exists (Insert before Title)
                if (job.logo_url) {
                    const logoImg = document.createElement('img');
                    logoImg.src = job.logo_url;
                    logoImg.style.width = '80px';
                    logoImg.style.height = '80px';
                    logoImg.style.objectFit = 'contain';
                    logoImg.style.borderRadius = '8px';
                    logoImg.style.marginBottom = '20px';
                    logoImg.style.border = '1px solid #eee';

                    const titleEl = document.getElementById('job-title');
                    titleEl.parentNode.insertBefore(logoImg, titleEl);
                }

                // Update Apply Button
                const applyLink = `/apply.html?jobId=${job.id}&jobTitle=${encodeURIComponent(job.title)}`;
                document.getElementById('apply-btn').href = applyLink;

                // Dynamic SEO & Social Tags
                document.title = `${job.title} at ${job.location} | RestaurantJobs Kenya`;

                // Meta Description
                let metaDesc = document.querySelector('meta[name="description"]');
                if (!metaDesc) {
                    metaDesc = document.createElement('meta');
                    metaDesc.name = 'description';
                    document.head.appendChild(metaDesc);
                }
                metaDesc.content = `Hiring: ${job.title} in ${job.location}. ${job.type}. Apply now on RestaurantJobs Kenya.`;

                // Open Graph Title
                let ogTitle = document.querySelector('meta[property="og:title"]');
                if (!ogTitle) {
                    ogTitle = document.createElement('meta');
                    ogTitle.setAttribute('property', 'og:title');
                    document.head.appendChild(ogTitle);
                }
                ogTitle.content = `${job.title} | RestaurantJobs Kenya`;

                // Show
                document.getElementById('loading').style.display = 'none';
                document.getElementById('job-content').style.display = 'block';

            } catch (err) {
                console.error(err);
                showError(err.message);
            }
        }

        function showError(msg) {
            document.getElementById('loading').style.display = 'none';
            const errDiv = document.getElementById('error-msg');
            errDiv.style.display = 'block';
            if (msg) {
                errDiv.querySelector('p').innerText = "Error: " + msg;
            }
        }

        loadJobDetails();
    </script>
</body>

</html>